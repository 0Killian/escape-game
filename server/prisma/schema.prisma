generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Room {
  id           String   @id @default(uuid())
  code         String   @unique
  hostPlayerId String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  players      Player[]
  timer        Int      @default(2700) // 45 minutes in seconds
  Enigma1      Enigma1?
  Enigma2      Enigma2?
  Enigma3      Enigma3?
  Enigma4      Enigma4?
}

model Player {
  id           String   @id @default(uuid())
  room         Room?    @relation(fields: [roomId], references: [id])
  roomId       String?
  pseudo       String
  isHost       Boolean  @default(false)
  lastSeenAt   DateTime @default(now())
  connected    Boolean  @default(true)
  currentScene String
}

// ÉNIGME 1 : Le Storyboard Éclaté
//
// Concept pédagogique :
// Comprendre la continuité narrative et le découpage en plans
//
// Mécanique de jeu :
// 8 images de storyboard mélangées à l'écran
// Le joueur doit les glisser-déposer dans l'ordre chronologique correct
// Indices visuels : raccords dans l'axe, position des personnages, lumière du jour
//
// Feedback pédagogique après réussite :
// "Bravo ! Vous avez compris la continuité narrative. Au cinéma, chaque plan doit s'enchaîner logiquement avec le suivant (règle des 30°, respect de l'axe d'action)."
model Enigma1 {
  roomId      String  @id
  Room        Room    @relation(fields: [roomId], references: [id])
  storyboards Json[]
  completed   Boolean @default(false)
}

// ÉNIGME 2 : Le Laboratoire Lumière
//
// Concept pédagogique :
// Schémas d'éclairage classiques (3-point lighting, low-key, high-key)
//
// Mécanique de jeu :
// 6 photos d'un même sujet éclairé différemment
// Le joueur doit identifier le type d'éclairage (liste déroulante ou glisser des étiquettes)
// Exemples : "Éclairage 3 points", "Contre-jour", "Lumière naturelle", "Low-key (film noir)"
//
// Feedback pédagogique :
// "L'éclairage raconte autant que les dialogues. Le 3-point lighting (key + fill + backlight) est la base. Le low-key crée du mystère, le high-key de la légèreté."
model Enigma2 {
  roomId    String   @id
  Room      Room     @relation(fields: [roomId], references: [id])
  photos    String[]
  completed Boolean  @default(false)
}

// ÉNIGME 3 : Le Casting Narratif
//
// Concept pédagogique :
// Archétypes narratifs (voyage du héros de Joseph Campbell)
//
// Mécanique de jeu :
// 8 cartes de personnages avec descriptions
// 8 rôles narratifs : Héros, Mentor, Gardien du seuil, Héraut, Ombre, Allié, Trickster, Shapeshifter
// Associer chaque personnage à son archétype
//
// Feedback pédagogique :
// "La plupart des histoires suivent des structures universelles. Le Héros (protagoniste), le Mentor (guide), l'Ombre (antagoniste) sont des rôles récurrents depuis l'Odyssée jusqu'à Star Wars."
model Enigma3 {
  roomId    String   @id
  Room      Room     @relation(fields: [roomId], references: [id])
  roles     String[]
  completed Boolean  @default(false)
}

// ÉNIGME 8 : La Bande-Son Manquante
//
// Concept pédagogique :
// Design sonore et impact émotionnel de la musique/bruitages
//
// Mécanique de jeu :
// Une scène muette s'affiche (15-20 sec)
// 4 ambiances sonores disponibles : Suspense, Romance, Action, Comédie
// Le joueur teste chaque ambiance et doit choisir celle qui correspond au genre suggéré par les images
//
// Feedback pédagogique :
// "50% de l'émotion au cinéma vient du son ! La même scène peut devenir drôle, effrayante ou romantique selon la musique et les effets sonores."
model Enigma4 {
  roomId    String  @id
  Room      Room    @relation(fields: [roomId], references: [id])
  ambiance  String?
  completed Boolean @default(false)
}
